#!/bin/bash

# DO NOT TRY TO EDIT THIS FILE.
# ALL YOUR CORRECTIONS WILL BE LOST WITH RERUNNING CMAKE.

# Automatic generated with:
# '@CMAKE_CURRENT_LIST_FILE@'
# at:
# '@CURRENT_TIME@'

set -euo pipefail

# Console output settings
CONSOLE_COLOR_WHITE='\e[0;37m'
CONSOLE_COLOR_RED='\x1b[31m'
RESET_CONSOLE_OUTPUT_SETTINGS='\e[0m'

function custom_echo
{
    local color=$1 msg=$2

    echo -e "${color}${msg}${RESET_CONSOLE_OUTPUT_SETTINGS}"
}

function custom_echo_err
{
    local color=$1 msg=$2

    echo -e "${color}${msg}${RESET_CONSOLE_OUTPUT_SETTINGS}" >&2
}

function skip_line_in_console
{
    echo
}

function check_that_exists
{
    local program=$1

    if ! command -v "${program}" >/dev/null 2>&1; then
        custom_echo_err "${CONSOLE_COLOR_RED}" "'${program}' not found."
        custom_echo "${CONSOLE_COLOR_WHITE}" "This script requires '${program}' to be installed."
        return 1
    fi

    return 0
}

function no_such_file_message
{
    local file="$1"
    custom_echo_err "$CONSOLE_COLOR_RED" "No such file:"
    custom_echo_err "" "\`$file'"

}

if [ $# -ne 1 ]; then
    custom_echo_err "" "Usage:"
    custom_echo_err "" "$0 <test number>"
    exit 1
fi

check_that_exists python3 || exit 1

ntest="$1"

if ! [[ "$ntest" =~ ^[0-9]+$ ]] || [ "$ntest" -le 0 ]; then
    custom_echo_err "${CONSOLE_COLOR_RED}" "bad test name. it's must be number from 1 to 9999"
    exit 1
fi

if [ $ntest -lt 10 ]; then
    test_name="000$ntest"
elif [ $ntest -lt 100 ]; then
    test_name="00$ntest"
elif [ $ntest -lt 1000 ]; then
    test_name="0$ntest"
elif [ $ntest -lt 10000 ]; then
    test_name="$ntest"
else
    custom_echo_err "${CONSOLE_COLOR_RED}" "too big test number. I can parse only if it\`s less then 10000 (10^4)"
    exit 1
fi

parse_test_sript="@PYTHON_RUN_TEST_SCRIPT@"
paracl_exe="@CMAKE_BINARY_DIR@/@PARACL_EXE@"
dat="@PARACL_E2E_DAT_DIR@/$test_name.pcl"
ans="@PARACL_E2E_ANS_DIR@/$test_name.ans"

if ! [ -f "$parse_test_sript" ]; then
    no_such_file_message "$parse_test_sript"
    exit 1
fi

if ! [ -f "$paracl_exe" ]; then
    no_such_file_message "$paracl_exe"
    exit 1
fi

if ! [ -f "$dat" ]; then
    no_such_file_message "$dat"
    exit 1
fi

if ! [ -f "$ans" ]; then
    no_such_file_message "$ans"
    exit 1
fi


"$parse_test_sript" \
    "$paracl_exe" \
    "$dat" \
    "$ans"
